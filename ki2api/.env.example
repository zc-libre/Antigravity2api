# ============================================================================
# Ki2API 环境配置文件示例
# ============================================================================
# 复制此文件为 .env 并根据需要修改配置

# ============================================================================
# API 认证密钥
# ============================================================================
# 用于验证客户端请求的 API 密钥
API_KEY=ki2api-key-2024

# ============================================================================
# Token 管理配置（必需）
# ============================================================================
#
# 支持两种配置方式：
#   1. 直接配置 JSON 字符串（推荐用于简单配置）
#   2. 配置文件路径（推荐用于复杂配置或敏感信息管理）
#
# 每个认证配置对象包含：
# - auth: 认证方式，可选值为 "Social" 或 "IdC"
# - refreshToken: 刷新令牌（必需）
# - clientId: IdC 认证的客户端 ID（IdC 认证时必需）
# - clientSecret: IdC 认证的客户端密钥（IdC 认证时必需）
# - disabled: 是否禁用此配置（可选，默认 false）

# ============================================================================
# 方式 1：直接配置 JSON 字符串
# ============================================================================

# 示例 1：单个 Social 认证
KIRO_AUTH_TOKEN='[{"auth":"Social","refreshToken":"your_social_refresh_token_here"}]'

# 示例 2：多个 Social 认证（轮询）
# KIRO_AUTH_TOKEN='[
#   {"auth":"Social","refreshToken":"token1_here"},
#   {"auth":"Social","refreshToken":"token2_here"},
#   {"auth":"Social","refreshToken":"token3_here"}
# ]'

# 示例 3：单个 IdC 认证
# KIRO_AUTH_TOKEN='[{"auth":"IdC","refreshToken":"your_idc_refresh_token","clientId":"your_client_id","clientSecret":"your_client_secret"}]'

# 示例 4：混合认证（Social + IdC）
# KIRO_AUTH_TOKEN='[
#   {"auth":"Social","refreshToken":"social_token_1"},
#   {"auth":"IdC","refreshToken":"idc_token_1","clientId":"client_id_1","clientSecret":"secret_1"},
#   {"auth":"Social","refreshToken":"social_token_2"}
# ]'

# ============================================================================
# 方式 2：配置文件路径
# ============================================================================
# KIRO_AUTH_TOKEN=/path/to/auth_config.json
# KIRO_AUTH_TOKEN=./auth_config.json

# ============================================================================
# 兼容旧配置（单账号模式）
# ============================================================================
# 如果未设置 KIRO_AUTH_TOKEN，将使用以下单账号配置
# KIRO_REFRESH_TOKEN=your_refresh_token_here

# ============================================================================
# Token 获取方式
# ============================================================================
#
# Social tokens:
#   通常位于 ~/.aws/sso/cache/ 目录下的 JSON 文件中
#   文件名类似：kiro-auth-token.json
#   包含 "refreshToken" 字段
#
# IdC tokens:
#   位于 ~/.aws/sso/cache/ 目录下的 JSON 文件中
#   需要同时提供 clientId 和 clientSecret
#
# 自动检测：
#   如果未配置任何 token，系统会尝试从 ~/.aws/sso/cache/kiro-auth-token.json 读取

# ============================================================================
# 轮询策略说明
# ============================================================================
#
# - 系统使用"顺序选择"策略（sequential）
# - 按配置顺序依次使用 token
# - 当前 token 遇到 403（认证失败）或 429（速率限制）时自动切换到下一个
# - 支持多 token 自动负载均衡和容错
# - Token 缓存时间约 1 小时，自动刷新

# ============================================================================
# 监控端点
# ============================================================================
#
# GET /health - 健康检查
# GET /v1/token/status - Token 管理器状态（需要 API 密钥）
# POST /v1/token/reset - 重置所有 token 的耗尽状态（需要 API 密钥）

# ============================================================================
# 最佳实践
# ============================================================================
#
# 1. 生产环境配置：
#    - 配置多个 token 实现负载均衡和高可用
#    - 使用配置文件路径而非环境变量（更安全）
#    - 定期检查 /v1/token/status 监控 token 状态
#
# 2. 开发环境配置：
#    - 可以使用单个 token
#    - 系统会自动从本地 ~/.aws/sso/cache/ 读取
#
# 3. 故障排除：
#    - 检查日志中的 "token刷新" 相关信息
#    - 使用 /v1/token/status 查看当前 token 状态
#    - 使用 /v1/token/reset 重置耗尽状态
